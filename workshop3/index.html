<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tunnel Vision</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex.js"></script>
    <script>
      AFRAME.registerComponent('model-switcher', {
        schema: {
          models: {
            type: 'array',
            default: [
              "https://rssathe08311.github.io/tunnel-vision/workshop3/models/water/scene.gltf",
              "https://rssathe08311.github.io/tunnel-vision/workshop3/models/subway/scene.gltf",
              "https://rssathe08311.github.io/tunnel-vision/workshop3/models/plants/scene.gltf"
            ]
          },
          scales: {
            type: 'array',
            default: [
              "0.005 0.005 0.005", // Water
              "0.001 0.001 0.001", // Subway
              "0.001 0.001 0.001"  // Plants
            ]
          },
          currentIndex: { type: 'number', default: 0 }
        },
    
        init: function () {
          const sceneEl = document.querySelector("a-scene");
          const markerEl = this.el;
          const modelEntity = document.createElement("a-entity");

          const rotations = [
            "-65 0 0", // Water
            "-75 0 0",   // Subway
            "-75 0 0"    // Plants
          ];

          markerEl.appendChild(modelEntity);

          // Main model-loaded listener
          modelEntity.addEventListener("model-loaded", () => {
            // Apply rotation based on currentIndex
            modelEntity.setAttribute("rotation", rotations[this.data.currentIndex]);

            if (this.data.currentIndex === 0) {
              modelEntity.setAttribute("scale", "0.001 0.001 0.001");
              modelEntity.setAttribute("animation", {
                property: "scale",
                from: "0 0 0",
                to: this.data.scales[0],
                dur: 5000,
                easing: "easeOutCubic"
              });
            } else {
              modelEntity.removeAttribute("animation");
              modelEntity.setAttribute("scale", this.data.scales[this.data.currentIndex]);
            }

            modelEntity.setAttribute("visible", "true");
          });

          // Initial model setup
          modelEntity.setAttribute("gltf-model", this.data.models[this.data.currentIndex]);

          // On click, switch model
          sceneEl.addEventListener("click", () => {
            modelEntity.setAttribute("visible", "false");

            // Advance to next model
            this.data.currentIndex = (this.data.currentIndex + 1) % this.data.models.length;

            // Load new model (this will trigger model-loaded)
            modelEntity.setAttribute("gltf-model", this.data.models[this.data.currentIndex]);
          });
        }
      });
    </script>
    
  </head>
  <body style="margin: 0; overflow: hidden;">
    <p>Click anywhere to switch models</p>
    <a-scene embedded arjs>
      <a-marker preset="hiro" model-switcher>
        <!-- Model will be dynamically added here -->
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
