<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tunnel Vision</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex.js"></script>
    <script>
      AFRAME.registerComponent('model-switcher', {
        schema: {
          models: {
            type: 'array',
            default: [
              "https://rssathe08311.github.io/tunnel-vision/workshop3/models/water/scene.gltf",
              "https://rssathe08311.github.io/tunnel-vision/workshop3/models/subway/scene.gltf",
              "https://rssathe08311.github.io/tunnel-vision/workshop3/models/plants/scene.gltf"
            ]
          },
          scales: {
            type: 'array',
            default: [
              "0.003 0.003 0.003",
              "0.005 0.005 0.005",
              "0.002 0.002 0.002"
            ]
          },
          currentIndex: { type: 'number', default: 0 }
        },
        init: function() {
          const sceneEl = this.el;
          const modelEntity = document.createElement("a-entity");
          modelEntity.setAttribute("gltf-model", this.data.models[this.data.currentIndex]);
          modelEntity.setAttribute("scale", this.data.scales[this.data.currentIndex]);
          modelEntity.setAttribute("position", "0 0 0");
          modelEntity.setAttribute("visible", "true");

          // Append the model entity to the scene
          sceneEl.appendChild(modelEntity);

          // Click listener on the entire scene
          sceneEl.addEventListener("click", () => {
            // Hide current model
            modelEntity.setAttribute("visible", "false");

            // Switch to next model
            this.data.currentIndex = (this.data.currentIndex + 1) % this.data.models.length;
            modelEntity.setAttribute("gltf-model", this.data.models[this.data.currentIndex]);
            modelEntity.setAttribute("scale", this.data.scales[this.data.currentIndex]);

            // Ensure model is visible when loaded
            modelEntity.addEventListener("model-loaded", () => {
              modelEntity.setAttribute("visible", "true");
            }, { once: true });
          });
        }
      });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <p>Click anywhere to switch models</p>
    <a-scene embedded arjs model-switcher>
      <a-marker preset="hiro"></a-marker>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
